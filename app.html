<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Statistiche Basket</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta name="theme-color" content="#2c3e50">
</head>
<body>
  <!-- Bottone Hamburger -->
  <div id="hamburgerMenu">
    <button id="hamburgerBtn">‚ò∞</button>
  </div>
  <!-- Intestazione -->
  <div id="header">

	<!-- Bottone Admin -->
	<div id="adminButtonContainer">
	  <button id="adminBtn">Admin</button>
	</div>

	<!-- Popup Admin -->
	<div id="adminPopup" class="hidden popup">
	  <div class="popup-content">
		<h2>Accesso Admin</h2>
		<input type="password" id="adminPassword" placeholder="Password admin">
		<button id="adminOkBtn">Ok</button>
		<button id="adminCancelBtn">Annulla</button>
	  </div>
	</div>

    <div id="teamNames">
	  <label id="teamA" class="squadra-label" >Squadra A</label>
      <label id="teamB" class="squadra-label" >Squadra B</label>
    </div>
    <div id="scoreboard">
      <div class="loading">Caricamento scoreboard...</div>
    </div>
  </div>

  <div id="contenuto">
    <div id="topControls">
    <div id="ordinamenti">
      <button><i class="fas fa-arrow-up"></i> Numero</button>
      <button><i class="fas fa-arrow-up"></i> Cognome</button>
      <button><i class="fas fa-arrow-up"></i> Punteggio</button>
    </div>
      <div id="squadraB" class="hidden">
        <h1 id="titoloB"></h1>
        <div class="squadraB-row">
          <span id="punti_squadraB" class="punteggio"></span>
		  <!-- Bottoni punteggio: nascosti di default -->
          <div id="controlsB">
          <!--  <button class="tiro">‚ûï1</button> -->
          <!--  <button class="tiro">‚ûï2</button> -->
          <!--  <button class="tiro">‚ûï3</button> -->
          <!--  <button class="undo">‚Ü©Ô∏è</button> -->
          </div>
        </div>
      </div>
    </div>

    <div id="giocatori">
      <div class="loading">Caricamento giocatori...</div>
    </div>
    <!-- Mostra la versione dello script -->
    <div id="scriptVersion" class="versione"></div>
  </div>

  <script src="script.js?v=1.0.33"></script>
  <script>
  function SalvaPunteggi() {
    //const punteggioA = document.getElementById("punti_squadraA")?.textContent || "0";
    //const punteggioB = document.getElementById("punti_squadraB")?.textContent || "0";
    //const matchId = localStorage.getItem("matchId"); // üîß recupera l'ID partita
  
    if (!matchId) {
      console.warn("Nessun matchId trovato, non salvo");
      return;
    }
  
    // Costruisci payload
    const payload = {
      matchId: matchId,
      punteggioA: puntiSquadraA,
      punteggioB: puntiSquadraB
    };
    const formData = new FormData();
    formData.append("matchId", matchId);
    formData.append("punteggioA", puntiSquadraA);
    formData.append("punteggioB", puntiSquadraB);
  
    // Invia al tuo Google Apps Script
    fetch("https://script.google.com/macros/s/AKfycbzJp7oDq1_vstaSyfY4jHVHvEH-LMUX2S5Mjg8laQSzwXYdGpWtrcxVr4pg_EM5JAACqQ/exec", {
      method: "POST",
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      console.log("Risposta dal server:", data);
    })
    .catch(error => {
      console.error("Errore nel salvataggio:", error);
    });
  }
  
  window.addEventListener("beforeunload", function (event) {
    // Mostra la finestra di conferma
	if (isAdmin) {
	  SalvaPunteggi();
      event.preventDefault();
      event.returnValue = "Vuoi salvare i dati prima di uscire o ricaricare?";
      // ‚ö†Ô∏è Nota: il messaggio personalizzato non sempre viene mostrato,
      // ma la finestra di conferma appare comunque.
	}
  });
  
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js").then((reg) => {
      console.log("Service Worker registrato");
    });

    // Quando un nuovo SW prende controllo, ricarica la pagina automaticamente
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      if (!window.__reloadedOnce) {
        window.__reloadedOnce = true;
        window.location.reload();
      }
    });
  }
</script>

</body>
</html>





