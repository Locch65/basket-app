<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Seleziona Partita</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h1>Calendario</h1>
  <button id="toggleTheme">ğŸŒ™ Dark Mode</button>
  <div id="listaPartite" class="loading">Caricamento Calendario...</div>

  <script>
    const url = 
	"https://script.google.com/macros/s/AKfycbyueecXxPq_JgfFb-Y2gKgj7agZ1ZXAvfMPrMXoXo3kRciQATa7GdkRyC4Qm0p1-47QDw/exec"
    function caricaListaPartite() {
      const container = document.getElementById("listaPartite");
      container.textContent = "Sto caricando il Calendario...";

      fetch(url + "?sheet=Partite")
        .then(res => res.json())
        .then(data => {
          container.classList.remove("loading");
          const partite = Array.isArray(data) ? data : data.data;

          if (!Array.isArray(partite) || partite.length === 0) {
            container.textContent = "Nessuna partita disponibile";
            return;
          }

          const frag = document.createDocumentFragment();

partite.forEach(p => {
  const card = document.createElement("div");
  card.classList.add("match-card");

  const casaIcon = "ğŸ ";
  const trasfertaIcon = "ğŸšŒ";
  const icona = (p.casaTrasferta === "Casa") ? casaIcon : trasfertaIcon;

  card.innerHTML = `
    <!-- Riga 1: MatchId, Casa/Trasferta, Data, Ora -->
    <div class="match-top">
      <span class="match-id">${p.matchId}</span>
      <span class="data">${p.data}</span>
      <span class="orario">${p.orario}</span>
    </div>

    <!-- Riga 2: Luogo allineato a destra -->
    <div class="match-middle">
      <span class="casa">${icona}</span>
      <span class="luogo">${p.luogo}</span>
    </div>

    <!-- Riga 3: SquadraA vs SquadraB -->
    <div class="match-bottom">
      <span class="teamA">${p.squadraA}</span>
      <span class="vs">vs</span>
      <span class="teamB">${p.squadraB}</span>
    </div>
  `;

  card.addEventListener("click", () => {
    localStorage.setItem("matchId", p.matchId);
    localStorage.setItem("teamA", p.squadraA);
    localStorage.setItem("teamB", p.squadraB);
    window.location.href = "app.html";
  });

  frag.appendChild(card);
});


          container.replaceChildren(frag);
        })
        .catch(err => {
          container.classList.remove("loading");
          container.textContent = "Errore caricamento partite: " + err.message;
          console.error(err);
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
      caricaListaPartite();

      // ğŸ”§ Ripristina tema salvato
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "dark") {
        document.body.classList.add("dark-mode");
        document.getElementById("toggleTheme").textContent = "â˜€ï¸ Light Mode";
      }

      // Toggle Dark Mode con salvataggio
      document.getElementById("toggleTheme").addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
        const isDark = document.body.classList.contains("dark-mode");
        localStorage.setItem("theme", isDark ? "dark" : "light");
        document.getElementById("toggleTheme").textContent = isDark ? "â˜€ï¸ Light Mode" : "ğŸŒ™ Dark Mode";
      });
    });
  </script>
</body>
</html>
