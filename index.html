<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <link rel="manifest" href="manifest.json">
  <title>Login Basket App</title>
  <script src="common.js"></script> 
  <style>
    body { font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; }
    .login-box { border:1px solid #ccc; padding:20px; border-radius:8px; text-align:center; }
    input { padding:8px; font-size:16px; margin-top:10px; }
    button { padding:8px 12px; margin-top:10px; font-size:16px; cursor:pointer; }
    #status-msg { margin-top: 15px; font-size: 14px; color: #555; }
  </style>
</head>
<body>
  <div class="login-box">
    <h2>Accesso in corso</h2>
    <p id="status-msg">controllo dirette in corso...</p>
    
    <div id="login-form" style="display:none;">
      <input type="password" id="pwd" placeholder="Password">
      <button onclick="checkLogin()">Accedi</button>
    </div>
    <p id="msg" style="color:red;"></p>
  </div>

  <script>
    async function checkLiveAndRedirect() {
      const status = document.getElementById("status-msg");
      try {
        // Recupero dati usando l'URL da common.js
        const response = await fetch(url + "?sheet=Partite"); 
        const data = await response.json();
        const partite = Array.isArray(data) ? data : data.data;

        // Cerca partita live
        const partitaLive = partite.find(p => p.isLive === "true" || p.isLive === true);

        if (partitaLive) {
          status.textContent = "Partita Live rilevata!";
          const scelta = confirm("C'Ã¨ una partita in diretta! Vuoi guardare la Diretta Video?");
          if (scelta) {
            // Salvataggio dati per la pagina successiva
            localStorage.setItem("matchId", partitaLive.matchId);
            localStorage.setItem("videoURL", partitaLive.videoURL);
            window.location.href = "direttavideo.html";
            return;
          }
        }
        
        // Se nessuna live o rifiuto, vai al calendario
        window.location.href = "calendario.html";
      } catch (err) {
        console.error("Errore:", err);
        status.textContent = "Errore di connessione. Reindirizzamento...";
        setTimeout(() => { window.location.href = "calendario.html"; }, 1500);
      }
    }

    // Avvia il controllo all'apertura
    window.onload = checkLiveAndRedirect;
  </script>
</body>
</html>
