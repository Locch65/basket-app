<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>YouTube HUD Demo â€“ Fix Error 153</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- IMPORTANTE: serve HTTPS e un dominio (non file://) -->
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: #111;
      color: #eee;
    }
  
    .video-container {
      width: 100vw;
      aspect-ratio: 16 / 9;   /* proporzione corretta in verticale */
      margin: 0;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
    }
  
    /* In orizzontale: forza fullscreen */
    @media (orientation: landscape) {
      .video-container {
        width: 100vw;
        height: 100vh;
        aspect-ratio: auto;   /* disattiva vincolo proporzioni */
        border-radius: 0;     /* opzionale: elimina bordi per fullscreen */
      }
    }
  
    #ytplayer {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }
  
    #hud-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      display: grid;
      place-items: start center;
      padding-top: 10px;
      color: #6CFF6C;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: clamp(16px, 2.4vw, 24px);
      text-shadow: 0 0 6px rgba(0,0,0,.9);
    }
  
    .badge {
      pointer-events: none;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(108,255,108,.4);
      border-radius: 12px;
      padding: .4rem .8rem;
      backdrop-filter: blur(4px);
    }
  
    @keyframes pulse {
      0%   { transform: scale(1); opacity: 1 }
      50%  { transform: scale(1.15); opacity: .8 }
      100% { transform: scale(1); opacity: 1 }
    }
    .pulse { animation: pulse 900ms ease; }
  </style>
</head>
<body>
  <div class="video-container">
    <iframe id="ytplayer"></iframe>

    <div id="hud-overlay">
      <div id="hud-label" class="badge">HUD 1.0.48</div>
    </div>
  </div>

  <!-- IFrame API: carica una sola volta, in global scope -->
<script src="https://www.youtube.com/iframe_api"></script>
<script>
  let player;
  const hudLabel = document.getElementById("hud-label");

  const urlParams = new URLSearchParams(window.location.search);
  const VideoId = urlParams.get("videoId") || "7LMjqTC9DyQ"; // fallback

  const hudMessages = [
    { time: 5, text: "ðŸ€ Inizio partita!" },
    { time: 15, text: "ðŸ”¥ Tripla spettacolare!" },
    { time: 30, text: "â± Timeout tecnico" },
    { time: 45, text: "ðŸ’ª Rimonta in corso!" }
  ];

  window.onYouTubeIframeAPIReady = function () {
    if (!VideoId) {
      hudLabel.textContent = "âš ï¸ Nessun VideoId fornito";
      return;
    }
    player = new YT.Player('ytplayer', {
      videoId: VideoId,
      playerVars: {
        origin: window.location.origin,
        rel: 0,
        modestbranding: 1,
        playsinline: 1,
        fs: 0
      },
      events: {
        'onReady': onPlayerReady,
        'onError': onPlayerError
      }
    });
  };

  function onPlayerReady() {
    hudLabel.textContent = "â–¶ï¸ Riproduzione pronta";
    tickTimeline();
  }

  function onPlayerError(e) {
    hudLabel.textContent = `âš ï¸ Errore player (${e?.data ?? "sconosciuto"})`;
  }

  function tickTimeline() {
    let lastShownAt = -1;
    setInterval(() => {
      if (!player || typeof player.getCurrentTime !== "function") return;
      const t = Math.floor(player.getCurrentTime());
      if (t === lastShownAt) return;
      const hit = hudMessages.find(m => m.time === t);
      if (hit) {
        hudLabel.textContent = hit.text;
        hudLabel.classList.add("pulse");
        setTimeout(() => hudLabel.classList.remove("pulse"), 900);
        lastShownAt = t;
      }
    }, 500);
  }

  // --- Metodo 1: API Fullscreen ---
  function requestFullscreen() {
    const el = document.querySelector(".video-container");
    if (el.requestFullscreen) {
      el.requestFullscreen();
    } else if (el.webkitRequestFullscreen) { // Safari
      el.webkitRequestFullscreen();
    }
  }

  window.addEventListener("orientationchange", () => {
    if (screen.orientation.type.startsWith("landscape")) {
      requestFullscreen();
    }
  });
</script>
</body>
</html>
